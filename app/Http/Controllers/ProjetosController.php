<?phpnamespace App\Http\Controllers;use Illuminate\Http\Request;use App;use Vinkla\Facebook\Facades\Facebook;use Cache;use App\Http\Requests\RequestProjetoForm;class ProjetosController extends Controller{    public function __construct()     {        $this->middleware('auth')->except('show','index');    }    /**     * Display a listing of the resource.     *     * @return \Illuminate\Http\Response     */    public function index()    {        $projetos = App\Projeto::orderBy('created_at', 'desc')->paginate(6);        $categorias = App\Categoria::all();        return view('projeto.ver-todos')->with(compact('projetos','categorias'));    }    /**     * Show the form for creating a new resource.     *     * @return \Illuminate\Http\Response     */    public function create()    {        $ambitos = App\Ambito::all()->pluck('name','id');        $categorias = App\Categoria::all()->pluck('name','id');        $eixos = App\Eixo::all()->pluck('name','id');        $instituicoes = App\Instituicao::all()->pluck('name','id');        return view('projeto.form-novo')->with(compact('ambitos', 'categorias', 'eixos', 'instituicoes'));    }    /**     * Store a newly created resource in storage.     *     * @param  \Illuminate\Http\Request  $request     * @return \Illuminate\Http\Response     */    //public function store(RequestProjetoForm $request)    public function store(Request $request)    {        $n = 0;        $var = [            'name' => $request->get('name'),            'descricao' => $request->get('descricao'),            'componente_curricular' => $request->get('componente_curricular'),            'tags' => $request->get('tags'),            'n_aulas' => $request->get('n_aulas'),            'n_alunos' => $request->get('n_alunos'),            'projeto' => $request->get('projeto'),            'instituicao_id' => $request->get('instituicao_id')        ];        try{            $projeto = new App\Projeto();            $projeto->fill($var);            $projeto->fill(['user_id' => auth()->user()->id]);            $projeto->tags();            $projeto->save();            while($request->has('name_prof_'.$n,'email_'.$n) and !empty($request->only('name_prof_'.$n, 'email_'.$n))){                $varProf = [                    'name_prof' => $request->get('name_prof_'.$n),                    'email' => $request->get('email_'.$n),                ];                $projeto->prof($varProf);                $n++;            }            App\Categoria::create(['name' => $projeto->componente_curricular]);            $n = 0;            while($request->has('campoNome_'.$n)){                $projeto->campos()->create(['name' => $request->get('campoNome_'.$n), 'val' => $request->get('campoVal_'.$n)]);                $n++;            }        } catch(\Excepition $e){            return redirect()->route('home')->with(['erro' =>'Erro ao tentar criar o Projeto, por favor confira os dados e tente novamente']);        }        return redirect()->route('home')->with(['sucesso' => 'Projeto criado com Sucesso!']);    }    /**     * Display the specified resource.     *     * @param  int  $id     * @return \Illuminate\Http\Response     */    public function show($id)    {        $projeto = App\Projeto::find($id);        $tags = App\Tag::all();        if(! Cache::has($id))        {            Cache::add($id, 'contador', 0.30);            $projeto->total_visualizacao+=1;            $projeto->save();        }        if(auth()->user())        {            $user = auth()->user();            $like = App\Like::where('projeto_id', $projeto->id)->where('user_id', $user->id)->first();        }        else            $like = null;        $url = env('APP_URL')."/projeto/".$id;        $campos = $projeto->campos;        dd($projeto->populares());        return  view('projeto.ver-um')->with(compact('projeto','like','url','tags','campos'));    }    /**     * Show the form for editing the specified resource.     *     * @param  int  $id     * @return \Illuminate\Http\Response     */    public function edit($id)    {        //    }    /**     * Update the specified resource in storage.     *     * @param  \Illuminate\Http\Request  $request     * @param  int  $id     * @return \Illuminate\Http\Response     */    public function update(Request $request, $id)    {        //    }    /**     * Remove the specified resource from storage.     *     * @param  int  $id     * @return \Illuminate\Http\Response     */    public function destroy($id)    {        //    }}